# AIテレアポ JSON Editor 操作説明書

## 目次
1. [概要](#概要)
2. [初期設定](#初期設定)
3. [顧客管理](#顧客管理)
4. [パターン管理](#パターン管理)
5. [マッチングテスト](#マッチングテスト)
6. [誤終話分析](#誤終話分析)
7. [データのインポート・エクスポート](#データのインポートエクスポート)

---

## 概要

AIテレアポ JSON Editorは、AI電話営業システムの応答パターンを視覚的に管理・編集するためのWebアプリケーションです。

### 主な機能
- 電話応答パターンの作成・編集・削除
- 正規表現パターンによるテキストマッチング
- パターンのインポート/エクスポート（JSON形式）
- 通話ログの分析（CSV形式）
- 誤終話リスクの検出と分析

---

## 初期設定

### 起動方法

1. ターミナルでプロジェクトディレクトリに移動
```bash
cd ai-teleapo-editor
```

2. 開発サーバーを起動
```bash
npm run dev
```

3. ブラウザで表示されたURL（通常は http://localhost:5173）にアクセス

---

## 顧客管理

### 顧客の追加

1. 左サイドバーの「顧客一覧」右上の **+** ボタンをクリック
2. 顧客名を入力
3. **✓**（チェック）ボタンで確定

### 顧客の選択

- 左サイドバーの顧客一覧から対象の顧客をクリック
- 選択した顧客のパターンが右側のメインエリアに表示されます

### 顧客の削除

1. 削除したい顧客にマウスをホバー
2. 右側に表示される **ゴミ箱アイコン** をクリック
3. 確認ダイアログで「OK」を選択

---

## パターン管理

### パターン一覧の表示

- メインエリアの「パターン一覧」タブを選択
- すべてのパターンがカード形式で表示されます

### パターンの検索

- 検索ボックスにキーワードを入力
- 日本語名または正規表現パターンで絞り込みができます

### パターンの追加

1. 「パターン追加」ボタンをクリック
2. 編集モーダルが開きます
3. 各項目を入力して「保存」をクリック

### パターンの編集

1. パターンカードにマウスをホバー
2. 「編集」ボタンをクリック
3. 編集モーダルで以下の項目を編集：

#### 基本情報
- **日本語名**: パターンの日本語名称（例: 導入及び在席確認）
- **English Name**: 英語での名称
- **タイプ**:
  - 通常応答（デフォルト）
  - 引継ぎ（transferCall）- 担当者への転送
  - 終了（endCall）- 通話終了

#### 判定基準
- このパターンを適用する条件の説明
- 複数の基準を設定可能
- 「+ 判定基準を追加」で追加、ゴミ箱アイコンで削除

#### 正規表現パターン
- テキストマッチング用の正規表現
- 複数のパターンを設定可能（いずれかにマッチすればOK）
- 例: `.*お世話.*なっております.*`

**正規表現の書き方のコツ:**
- `.*` は任意の文字列を意味します
- `(A|B)` はAまたはBを意味します
- 例: `.*(おせわ|お世話).*` → "おせわ"または"お世話"を含む

#### 音声ファイルパス
- 女性音声のファイルパス（例: `female/osewani_narimasu.wav`）
- 男性音声のファイルパス（例: `male/osewani_narimasu.wav`）

### パターンの複製

1. パターンカードにマウスをホバー
2. **コピーアイコン** をクリック
3. 同じ内容で新しいパターンが作成されます（「(コピー)」が名前に追加されます）

### パターンの削除

1. パターンカードにマウスをホバー
2. **ゴミ箱アイコン** をクリック
3. 確認ダイアログで「OK」を選択

---

## マッチングテスト

パターンが正しく動作するかを事前にテストできます。

### テストの実行

1. 「マッチングテスト」タブを選択
2. テキストエリアに確認したい文章を入力（例: 「はい。」）
3. リアルタイムでマッチ結果が表示されます

### 結果の見方

- **マッチあり**: マッチしたパターンが表示されます
  - パターンID、日本語名、タイプ
  - マッチした正規表現
  - 終了系パターンの場合は警告表示

- **マッチなし**: 「マッチするパターンがありません」と表示
  - 実際の通話では`undefined`となり、2回目以降の発話では誤終話の原因になる可能性があります

---

## 誤終話分析

CloudWatch Logsからエクスポートした通話ログを分析し、誤終話のリスクを検出します。

### ログのインポート

1. 「誤終話分析」タブを選択
2. 「CSVをインポート」ボタンをクリック
3. CloudWatch LogsからエクスポートしたCSVファイルを選択

**必要なCSV形式:**
- `transcript_text`: 発話テキスト
- `selectedId`: マッチしたパターンID
- `@timestamp`: タイムスタンプ

### 分析ダッシュボード

#### 統計情報
- **最初の発話**: undefinedは仕様通り（正常）
- **2回目以降（マッチ済）**: パターンマッチング対象
- **ID:35（誤終話リスク）**: 要確認

#### ID:35について
- ID:35は「判別不能」パターンで `type: endCall`
- このパターンにマッチすると通話が終了します
- 「はい。」等の相槌がマッチしている場合、会話の途中で誤って通話が切れている可能性があります

### 頻出ワード分析

- ID:35にマッチした発話で頻出するワードを表示
- ワードをクリックすると該当ログを絞り込み
- 誤終話の原因となっている表現を特定できます

### ログ一覧

#### フィルター
- **ID:35のみ**: 誤終話リスクのあるログのみ表示
- **終話系すべて**: すべての終話パターン
- **最初の発話**: undefined（参考）
- **すべて**: 全ログ表示

#### ログの活用
- 各ログの発話テキストとマッチしたパターンIDを確認
- ID:35のログには「別パターン作成」ボタンが表示されます
  - クリックすると該当テキストを元に新しいパターンが自動生成されます
  - 生成後、編集して正しい応答パターンを設定してください

---

## データのインポート・エクスポート

### JSONエクスポート

1. 顧客を選択
2. ヘッダー右側の「エクスポート」ボタンをクリック
3. `data_顧客ID.json` ファイルがダウンロードされます

**エクスポートされるデータ:**
- 選択中の顧客のすべてのパターン
- JSON形式（data.json互換）

### JSONインポート

1. 顧客を選択
2. ヘッダー右側の「インポート」ボタンをクリック
3. data.jsonファイルを選択
4. 既存のパターンが上書きされます

**注意事項:**
- インポートすると現在のパターンがすべて置き換えられます
- 事前にエクスポートでバックアップを取ることを推奨します

### データの保存

- すべてのデータはブラウザのローカルストレージに自動保存されます
- ブラウザのキャッシュをクリアするとデータが消えるため、定期的にエクスポートしてください

---

## よくある質問

### Q1: パターンIDはどう決まりますか？
A: 自動採番されます。新規作成時は既存パターンの最大ID+1が割り当てられます。

### Q2: 正規表現のテストはできますか？
A: 「マッチングテスト」タブで実際の文章を入力してテストできます。

### Q3: ログをクリアしたい
A: 現在の画面からは削除できません。ブラウザの開発者ツールでローカルストレージの`ai-teleapo-logs`を削除してください。

### Q4: 複数の顧客のパターンを統合したい
A:
1. 各顧客のJSONをエクスポート
2. テキストエディタで手動でマージ
3. インポート

### Q5: Vercel版とローカル版のデータは同期されますか？
A: されません。それぞれ独立したローカルストレージを使用しています。

---

## トラブルシューティング

### パターンが保存されない
- ブラウザのローカルストレージが有効か確認
- プライベートブラウジングモードでは保存されません

### JSONインポートが失敗する
- ファイルが正しいJSON形式か確認
- 文字コードがUTF-8か確認

### ログが正しく表示されない
- CSVファイルが正しい形式か確認
- 必須カラム（transcript_text, selectedId）が含まれているか確認

---

## サポート

問題が解決しない場合は、以下の情報を添えてお問い合わせください：
- ブラウザの種類とバージョン
- エラーメッセージのスクリーンショット
- 再現手順
